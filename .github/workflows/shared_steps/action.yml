name: "Shared Build Steps"
inputs:
  repo_root_path:
    description: "Path to flexiv_rdk repo"
    required: true
runs:
  using: "composite"
  steps:
    # Build and install all dependencies to RDK installation directory.
    - name: Build and install dependencies
      shell: bash
      run: |
        pwd
        ls
        cd thirdparty
        bash build_and_install_dependencies.sh ~/rdk_install 4

    # Configure CMake, then build and install flexiv_rdk library to RDK installation directory.
    - name: Build and install library
      shell: bash
      run: |
        cd ${{ inputs.repo_root_path }}
        mkdir -p build && cd build
        cmake .. -DCMAKE_INSTALL_PREFIX=~/rdk_install
        make install

    # Find and link to flexiv_rdk library, then build all example programs.
    - name: Build examples
      shell: bash
      run: |
        cd ${{ inputs.repo_root_path }}/example
        mkdir -p build && cd build
        cmake .. -DCMAKE_INSTALL_PREFIX=~/rdk_install
        make -j4

    # Find and link to flexiv_rdk library, then build all test programs.
    - name: Build tests
      shell: bash
      run: |
        cd ${{ inputs.repo_root_path }}/test
        mkdir -p build && cd build
        cmake .. -DCMAKE_INSTALL_PREFIX=~/rdk_install
        make -j4
